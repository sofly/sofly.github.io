var G=Object.defineProperty,q=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var V=(e,t,s)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,p=(e,t)=>{for(var s in t||(t={}))Z.call(t,s)&&V(e,s,t[s]);if(C)for(var s of C(t))$.call(t,s)&&V(e,s,t[s]);return e},g=(e,t)=>q(e,W(t));import{r as c,a as K,R as A,j as L,c as J,b as Q,d as X}from"./vendor.d010ece7.js";const Y=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}};Y();var m;(function(e){e.Idle="idle",e.Failed="failed",e.Fetched="fetched",e.Fetching="fetching",e.Refetching="refetching"})(m||(m={}));const ee=e=>e===m.Idle,te=e=>e===m.Failed,se=e=>e===m.Fetched,re=e=>e===m.Fetching,j=e=>typeof(e==null?void 0:e.error)=="string"?e.error:typeof(e==null?void 0:e.message)=="string"?e.message:String(e),D=e=>{const t=c.exports.useRef();return t.current||(t.current=e()),t.current};var f;(function(e){e.Idle="idle",e.Initializing="initializing",e.Ready="ready",e.Failed="failed",e.AccessDenied="access-denied",e.OverconstrainedError="overconstrained-error"})(f||(f={}));class oe extends Error{constructor(t){super(t);this.name="OverconstrainedError"}}const ae=({videoRef:e,streamWidth:t,streamHeight:s,streamAspectRatio:i,capabilities:o})=>{const[n,a]=c.exports.useState({state:f.Idle,error:null,stream:null,errorMessage:null}),r=c.exports.useRef(n);r.current=n;const I=D(()=>({createStream:async()=>{var d,x,F,T;try{a(R=>g(p({},R),{state:f.Initializing}));const l=await window.navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:t},height:{ideal:s},aspectRatio:{ideal:i}},audio:!1});if(r.current.stream=l,o&&!{}.VITE_IS_LOCAL_BUILD){const y=l.getVideoTracks()[0].getCapabilities();if(((x=(d=y==null?void 0:y.width)==null?void 0:d.max)!=null?x:0)<o.width||((T=(F=y==null?void 0:y.height)==null?void 0:F.max)!=null?T:0)<o.height)throw new oe("Camera capabilities is not supported")}e.current.srcObject=l,a(R=>g(p({},R),{stream:l,state:f.Ready}))}catch(l){let R=f.Failed;(l==null?void 0:l.name)==="NotAllowedError"&&(R=f.AccessDenied),(l==null?void 0:l.name)==="OverconstrainedError"&&(R=f.OverconstrainedError),a(y=>g(p({},y),{error:l,state:R,errorMessage:j(l)}))}},stopStream:()=>{var d;(d=r.current.stream)==null||d.getTracks().forEach(x=>x.stop())}})),b=D(()=>({isStateIdle:()=>r.current.state===f.Idle,isStateReady:()=>r.current.state===f.Ready,isStateFailed:()=>r.current.state===f.Failed,isStateInitializing:()=>r.current.state===f.Initializing,isStateAccessDenied:()=>r.current.state===f.AccessDenied,isStateOverconstrainedError:()=>r.current.state===f.OverconstrainedError}));return c.exports.useEffect(()=>I.stopStream,[]),[n,I,b]},P={isPlaying:!1,isLoadedMetaData:!1},ne=()=>{const[e,t]=c.exports.useState(P),s=D(()=>({videoPlaying:()=>{t(i=>g(p({},i),{isPlaying:!0}))},videoLoadedMetadata:()=>{t(i=>g(p({},i),{isLoadedMetaData:!0}))},resetVideoState:()=>t(P)}));return[e,s]},ie=()=>{const[e,t]=c.exports.useState({state:m.Idle,error:null}),s=c.exports.useMemo(()=>({setToIdle:()=>t(()=>({error:null,state:m.Idle})),setToFailed:o=>t(()=>({error:j(o),state:m.Failed})),setToFetched:()=>t(()=>({error:null,state:m.Fetched})),setToFetching:()=>t(()=>({error:null,state:m.Fetching}))}),[t]),i=c.exports.useMemo(()=>({isStateIdle:()=>ee(e.state),isStateFailed:()=>te(e.state),isStateFetched:()=>se(e.state),isStateFetching:()=>re(e.state)}),[e]);return[e,s,i]},ce=()=>{const[e,t]=c.exports.useState(null),[s,i,o]=ie(),n=async a=>{try{i.setToFetching();const r=new FormData;r.append("file",a),r.append("upload_preset","selfie"),r.append("tags[]","video"),r.append("public_id",`${Date.now()}`);const I=await K.post("https://api.cloudinary.com/v1_1/hl7aznolk/video/upload",r,{headers:{"Content-Type":"multipart/form-data"}});t(I.data.secure_url),i.setToFetched()}catch(r){i.setToFailed(r)}};return[g(p({},s),{link:e}),{uploadVideo:n},o]};var S;(function(e){e.IDLE="idle",e.INITIALIZED="initialized",e.RECORDING="recording",e.RECORDED="recorded"})(S||(S={}));const U={error:null,state:S.IDLE,recorder:null},de=()=>{const[e,t]=c.exports.useState(U),s=c.exports.useRef(e);s.current=e;const i=D(()=>({reset:()=>t(U),initialize:a=>{let r=null,I=null;try{I=new A.exports.RecordRTCPromisesHandler(a,{type:"video",mimeType:"video/webm;codecs=vp8",recorderType:A.exports.MediaStreamRecorder})}catch(b){r=b}t(b=>g(p({},b),{error:r,state:S.INITIALIZED,recorder:I}))},startRecording:async()=>{var a;await((a=s.current.recorder)==null?void 0:a.startRecording()),t(r=>g(p({},r),{state:S.RECORDING}))},stopRecording:async()=>{var a;await((a=s.current.recorder)==null?void 0:a.stopRecording()),t(r=>g(p({},r),{state:S.RECORDED}))}})),o=D(()=>({isStateIdle:()=>s.current.state===S.IDLE,isStateInitialized:()=>s.current.state===S.INITIALIZED,isStateRecording:()=>s.current.state===S.RECORDING,isStateRecorded:()=>s.current.state===S.RECORDED,getBlob:()=>{var a;return(a=s.current.recorder)==null?void 0:a.getBlob()},getBlobSize:async()=>{var r;const a=await((r=s.current.recorder)==null?void 0:r.getBlob());return a?A.exports.bytesToSize(a.size):null}}));return[c.exports.useMemo(()=>{const a=p({},e);return delete a.recorder,a},[e]),i,o]},O={WIDTH:1600,HEIGHT:1200,ASPECT_RATIO:4/3},u=L.exports.jsx,v=L.exports.jsxs,le=L.exports.Fragment;function ue(){var N,z;const e=c.exports.useRef(null);c.exports.useRef(null);const[t,s]=c.exports.useState({size:"0",counter:0,blobType:"-",startedAt:null}),[i,o]=ne(),[n,a,r]=ce(),[I,b,d]=de(),[x,F,T]=ae({videoRef:e,streamWidth:O.WIDTH,streamHeight:O.HEIGHT,streamAspectRatio:O.ASPECT_RATIO});c.exports.useEffect(()=>{F.createStream()},[]),c.exports.useEffect(()=>{!T.isStateReady()||b.initialize(x.stream)},[x]),c.exports.useEffect(()=>{if(!d.isStateRecording())return;const h=setInterval(async()=>{s(w=>g(p({},w),{counter:w.counter+1}))},1e3);return()=>{clearInterval(h)}},[I]);const l=()=>{b.startRecording(),s(h=>g(p({},h),{startedAt:Date.now()}))},R=async()=>{const h=await d.getBlob();await a.uploadVideo(h)},y=async()=>{var M,k;await b.stopRecording();const h=await d.getBlob(),w=(M=await d.getBlobSize())!=null?M:"0",H=(k=h==null?void 0:h.type)!=null?k:"-";s(B=>g(p({},B),{size:w,blobType:H})),h&&e.current&&(e.current.srcObject=null,e.current.src=URL.createObjectURL(h))},_=i.isPlaying&&i.isLoadedMetaData&&T.isStateReady()&&!d.isStateIdle(),E=(N=x.stream)==null?void 0:N.getVideoTracks()[0].getSettings();return v("div",{className:"max-w-lg mx-auto",children:[v("div",{className:"-scale-x-100 relative",children:[u("video",{ref:e,muted:!0,onPlay:o.videoPlaying,autoPlay:!0,controls:!1,playsInline:!0,loop:d.isStateRecorded(),onLoadedMetadata:o.videoLoadedMetadata}),(d.isStateInitialized()||d.isStateRecording())&&v("p",{className:"font-sans absolute bg-black text-white -scale-x-100 right-0 bottom-0 p-1",children:[t.startedAt?Math.floor((Date.now()-t.startedAt)/1e3):0,"s"]})]}),v("div",{className:"p-4",children:[u("div",{className:"flex row-auto space-x-1.5 justify-start w-full mb-4",children:v(le,{children:[d.isStateInitialized()&&u("button",{className:"block rounded-md py-2 px-6 bg-green-300",onClick:l,children:"Record"}),d.isStateRecording()&&u("button",{className:"block rounded-md py-2 px-6 bg-red-300",onClick:y,children:"Stop Recording"}),d.isStateRecorded()&&!r.isStateFetched()&&u("button",{className:"block rounded-md py-2 px-6 bg-blue-300",onClick:R,children:"Upload to cloudinary"}),r.isStateFetched()&&u("a",{href:n.link,className:"block rounded-md py-2 px-6 bg-yellow-300",children:"Download video"})]})}),v("p",{className:"w-full font-sans text-left",children:[u("b",{children:"Info:"})," ",u("br",{}),"MimeType: video/mp4 ",u("br",{}),"Video resolution: ",E==null?void 0:E.width,"x",E==null?void 0:E.height," ",u("br",{}),"Size: ",t.size," ",u("br",{}),"Blob type: ",t.blobType," ",u("br",{}),"URL: ",(z=n.link)!=null?z:"-"]})]}),u("div",{className:J("absolute inset-0 flex justify-center items-center bg-white",{hidden:_&&!r.isStateFetching()}),children:v("p",{children:[r.isStateFetching()?"Uploading":"Loading","..."]})})]})}Q.render(u(X.StrictMode,{children:u(ue,{})}),document.getElementById("root"));
